{"md5":"05bb97caa26dfd875a951c4fc628f01e","content":"<div id=\"outline-container-sec-1\" class=\"outline-2\">\n<h2 id=\"sec-1\"><span class=\"section-number-2\">1</span> 引子</h2>\n<div class=\"outline-text-2\" id=\"text-1\">\n<p>\n前段时间折腾了个 <a href=\"https://github.com/CodeFalling/hexo-renderer-org\">CodeFalling/hexo-renderer-org</a> 来让 hexo 支持 orgmode，然后就开始在 emacs 下写博客。当时为了操作方便等用 emacs-lisp 写了几个简单的函数，例如用 <code>ido</code> 直接打开 <code>source/_post</code> ，新建文章等。但后来看了 <a href=\"http://zilongshanren.com/\">子龙山人</a> 录的 <a href=\"https://github.com/zilongshanren/Spacemacs-rocks/issues/11\">Spacemacs Org-mode as a blogging engine</a> 。才发现还有一个 <a href=\"https://github.com/yoshinari-nomura/org-octopress\">yoshinari-nomura/org-octopress</a> 。\n</p>\n</div>\n</div>\n\n<div id=\"outline-container-sec-2\" class=\"outline-2\">\n<h2 id=\"sec-2\"><span class=\"section-number-2\">2</span> org-octopress</h2>\n<div class=\"outline-text-2\" id=\"text-2\">\n<p>\n<code>org-octopress</code> 本是让 <code>octopress</code> 支持 orgmode 的 emacs 插件，它把 orgmode 渲染为 HTML 然后交给 <code>octopress</code> ，同时提供了一个很直观的 UI（如上图），可以直接在文章列表里打开对应的文章，删除文章，新增文章等。\n</p>\n\n<p>\n本文将如何在 <code>hexo+hexo-renderer-org</code> 的情况下借用其 UI，效果如下：\n</p>\n\n\n<div class=\"figure\">\n<p><img src=\"org-octopress-with-hexo-org/preview.jpg\" alt=\"效果预览\">\n</p>\n</div>\n\n<!--more-->\n</div>\n</div>\n<div id=\"outline-container-sec-3\" class=\"outline-2\">\n<h2 id=\"sec-3\"><span class=\"section-number-2\">3</span> hexo-renderer-org</h2>\n<div class=\"outline-text-2\" id=\"text-3\">\n<p>\n让 hexo 像支持 md 一样支持 org，把 org 文章扔到 <code>source/_post/</code> 即可。\n</p>\n\n<p>\n具体的介绍文章见：<a href=\"http://codefalling.com/tags/hexo-renderer-org/\">标签: hexo-renderer-org | M-x codefalling</a>\n</p>\n\n<p>\nGithub：<a href=\"https://github.com/CodeFalling/hexo-renderer-org\">CodeFalling/hexo-renderer-org</a>\n</p>\n</div>\n</div>\n\n<div id=\"outline-container-sec-4\" class=\"outline-2\">\n<h2 id=\"sec-4\"><span class=\"section-number-2\">4</span> hack</h2>\n<div class=\"outline-text-2\" id=\"text-4\">\n<p>\n首先安装 <code>org-octopress</code> 这个 package。然后在 <code>(require 'org-octopress)</code> 后重写它的一些函数。\n</p>\n\n<p>\n我使用的是 <code>spacemacs</code> ，如果你不使用可能需要做出一些改动。\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight lisp\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"list\">(<span class=\"keyword\">defun</span> codefalling/init-org-octopress <span class=\"list\">()</span></span><br><span class=\"line\">  <span class=\"list\">(<span class=\"keyword\">use-package</span> org-octopress</span><br><span class=\"line\">    <span class=\"keyword\">:config</span></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">progn</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-directory-top       <span class=\"string\">\"~/blog/source\"</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-directory-posts     <span class=\"string\">\"~/blog/source/_posts\"</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-directory-org-top   <span class=\"string\">\"~/blog/source\"</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-directory-org-posts <span class=\"string\">\"~/blog/source/_posts\"</span>)</span></span><br><span class=\"line\">      )</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">;; rewrite in org-octopress.el</span></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">defun</span> org-octopress--summary-table <span class=\"list\">(<span class=\"keyword\">contents</span> keymap)</span> <span class=\"comment\">;; 去掉 publish 这一列，因为 hexo 不需要</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">let</span> <span class=\"list\">(<span class=\"list\">(<span class=\"keyword\">param</span> <span class=\"list\">(<span class=\"keyword\">copy-ctbl</span><span class=\"keyword\">:param</span> ctbl<span class=\"keyword\">:default-rendering-param</span>)</span>)</span>)</span></span><br><span class=\"line\">\t<span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:create-table-component-region</span></span><br><span class=\"line\">\t <span class=\"keyword\">:param</span> param</span><br><span class=\"line\">\t <span class=\"keyword\">:width</span>  <span class=\"literal\">nil</span></span><br><span class=\"line\">\t <span class=\"keyword\">:height</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t <span class=\"keyword\">:keymap</span> keymap</span><br><span class=\"line\">\t <span class=\"keyword\">:model</span></span><br><span class=\"line\">\t <span class=\"list\">(<span class=\"keyword\">make-ctbl</span><span class=\"keyword\">:model</span></span><br><span class=\"line\">\t  <span class=\"keyword\">:data</span> contents</span><br><span class=\"line\">\t  <span class=\"keyword\">:sort-state</span> <span class=\"quoted\">'(<span class=\"number\">-1</span> <span class=\"number\">2</span>)</span></span><br><span class=\"line\">\t  <span class=\"keyword\">:column-model</span></span><br><span class=\"line\">\t  <span class=\"list\">(<span class=\"keyword\">list</span> <span class=\"list\">(<span class=\"keyword\">make-ctbl</span><span class=\"keyword\">:cmodel</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:title</span> <span class=\"string\">\"Date\"</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:sorter</span> <span class=\"quoted\">'ctbl</span><span class=\"keyword\">:sort-string-lessp</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:min-width</span> <span class=\"number\">10</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:align</span> <span class=\"quoted\">'left</span>)</span></span><br><span class=\"line\">\t\t<span class=\"list\">(<span class=\"keyword\">make-ctbl</span><span class=\"keyword\">:cmodel</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:title</span> <span class=\"string\">\"Category\"</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:align</span> <span class=\"quoted\">'left</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:sorter</span> <span class=\"quoted\">'ctbl</span><span class=\"keyword\">:sort-string-lessp</span>)</span></span><br><span class=\"line\">\t\t<span class=\"list\">(<span class=\"keyword\">make-ctbl</span><span class=\"keyword\">:cmodel</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:title</span> <span class=\"string\">\"Title\"</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:align</span> <span class=\"quoted\">'left</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:min-width</span> <span class=\"number\">40</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">:max-width</span> <span class=\"number\">140</span>)</span></span><br><span class=\"line\">\t\t)</span>)</span>)</span>)</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">defun</span> org-octopress <span class=\"list\">(<span class=\"keyword\">&optional</span> title)</span></span><br><span class=\"line\">      <span class=\"string\">\"Org-mode and Octopress.\"</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">interactive</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-summary-buffer <span class=\"list\">(<span class=\"keyword\">get-buffer-create</span> <span class=\"string\">\"Octopress\"</span>)</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">switch-to-buffer</span> org-octopress-summary-buffer)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">setq</span> buffer-read-only <span class=\"literal\">nil</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">erase-buffer</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">insert</span> <span class=\"list\">(<span class=\"keyword\">org-octopress--summary-header</span> title)</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">save-excursion</span></span><br><span class=\"line\">\t<span class=\"list\">(<span class=\"keyword\">setq</span> org-octopress-component <span class=\"list\">(<span class=\"keyword\">org-octopress--summary-table</span></span><br><span class=\"line\">\t\t\t\t       <span class=\"list\">(<span class=\"keyword\">org-octopress--scan-post</span>)</span> org-octopress-summary-mode-map)</span>)</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:cp-add-click-hook</span></span><br><span class=\"line\">       org-octopress-component</span><br><span class=\"line\">       <span class=\"list\">(<span class=\"keyword\">lambda</span> <span class=\"list\">()</span></span><br><span class=\"line\">\t <span class=\"list\">(<span class=\"keyword\">find-file</span> <span class=\"list\">(<span class=\"keyword\">nth</span> <span class=\"number\">3</span> <span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:cp-get-selected-data-row</span> org-octopress-component)</span>)</span>)</span>)</span>)</span> <span class=\"comment\">;; 这里的 4 改为 3，因为我修改了列数</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">org-octopress-summary-mode</span>)</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:navi-goto-cell</span></span><br><span class=\"line\">       <span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:find-first-cell</span> <span class=\"list\">(<span class=\"keyword\">ctbl</span><span class=\"keyword\">:component-dest</span> org-octopress-component)</span>)</span>)</span></span><br><span class=\"line\">      )</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">define-key</span> org-octopress-summary-mode-map <span class=\"string\">\"w\"</span> <span class=\"quoted\">'codefalling/hexo-org-new-open-post</span>)</span> <span class=\"comment\">;; 讲 \"w\" 绑定到 ~codefalling/hexo-org-new-open-post~，这个函数是我自定义的</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">defun</span> org-octopress--scan-post <span class=\"list\">()</span></span><br><span class=\"line\">      <span class=\"list\">(<span class=\"keyword\">mapcar</span></span><br><span class=\"line\">       <span class=\"list\">(<span class=\"keyword\">lambda</span> <span class=\"list\">(<span class=\"keyword\">filename</span>)</span></span><br><span class=\"line\">\t <span class=\"list\">(<span class=\"keyword\">org-jekyll-property</span></span><br><span class=\"line\">\t  <span class=\"quoted\">'(<span class=\"keyword\">:date</span></span><br><span class=\"line\">\t    <span class=\"keyword\">:jekyll-categories</span></span><br><span class=\"line\">\t    <span class=\"keyword\">:title</span></span><br><span class=\"line\">\t    <span class=\"keyword\">:input-file</span>)</span></span><br><span class=\"line\">\t  filename)</span>)</span></span><br><span class=\"line\">       <span class=\"list\">(<span class=\"keyword\">directory-files</span></span><br><span class=\"line\">\t<span class=\"list\">(<span class=\"keyword\">expand-file-name</span></span><br><span class=\"line\">\t org-octopress-directory-org-posts)</span> <span class=\"literal\">t</span> <span class=\"string\">\"^.*\\\\.org$\"</span>)</span>)</span>)</span> <span class=\"comment\">;; jekyll 要求所有文章以日期开头，而 hexo 不需要</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">;; rewrite in ox-jekyll.el</span></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">defcustom</span> org-jekyll-date <span class=\"string\">\"\"</span></span><br><span class=\"line\">      <span class=\"string\">\"Default date used in Jekyll article.\"</span></span><br><span class=\"line\">      <span class=\"keyword\">:group</span> <span class=\"quoted\">'org-export-jekyll</span></span><br><span class=\"line\">      <span class=\"keyword\">:type</span> <span class=\"quoted\">'string</span>)</span></span><br><span class=\"line\">    <span class=\"list\">(<span class=\"keyword\">org-export-define-derived-backend</span><span class=\"quoted\">'jekyll</span> <span class=\"quoted\">'html</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"keyword\">:export-block</span> <span class=\"quoted\">'(<span class=\"string\">\"HTML\"</span> <span class=\"string\">\"JEKYLL\"</span>)</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"keyword\">:menu-entry</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"quoted\">'(?j <span class=\"string\">\"Jekyll: export to HTML with YAML front matter.\"</span></span><br><span class=\"line\">\t\t\t\t\t\t   ((?H <span class=\"string\">\"As HTML buffer\"</span> org-jekyll-export-as-html)</span><br><span class=\"line\">\t\t\t\t\t\t    (?h <span class=\"string\">\"As HTML file\"</span> org-jekyll-export-to-html)))</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"keyword\">:translate-alist</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"quoted\">'((template . org-jekyll-template) ;; add YAML front matter.</span><br><span class=\"line\">\t\t\t\t\t\t(src-block . org-jekyll-src-block)</span><br><span class=\"line\">\t\t\t\t\t\t(inner-template . org-jekyll-inner-template))</span> <span class=\"comment\">;; force body-only</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"keyword\">:options-alist</span></span><br><span class=\"line\">\t\t\t\t\t      <span class=\"quoted\">'((:jekyll-layout <span class=\"string\">\"LAYOUT\"</span> <span class=\"literal\">nil</span> org-jekyll-layout) ;; hexo-renderer-org 没有使用 JEKYLL 这个 prefix</span><br><span class=\"line\">\t\t\t\t\t\t(:jekyll-categories <span class=\"string\">\"CATEGORIES\"</span> <span class=\"literal\">nil</span> org-jekyll-categories)</span><br><span class=\"line\">\t\t\t\t\t\t(:jekyll-tags <span class=\"string\">\"TAGS\"</span> <span class=\"literal\">nil</span> org-jekyll-tags)</span><br><span class=\"line\">\t\t\t\t\t\t(:date <span class=\"string\">\"DATE\"</span> <span class=\"literal\">nil</span> org-jekyll-date)</span><br><span class=\"line\">\t\t\t\t\t\t(:jekyll-published <span class=\"string\">\"PUBLISHED\"</span> <span class=\"literal\">nil</span> org-jekyll-published)</span><br><span class=\"line\">\t\t\t\t\t\t(:jekyll-comments <span class=\"string\">\"COMMENTS\"</span> <span class=\"literal\">nil</span> org-jekyll-comments))</span>)</span></span><br><span class=\"line\">    )</span>)</span></span><br></pre></td></tr></table></figure>\n</div>\n\n<p>\n具体的改动可以对比 <a href=\"https://github.com/yoshinari-nomura/org-octopress/blob/master/ox-jekyll.el\">org-octopress/ox-jekyll.el at master · yoshinari-nomura/org-octopress</a> 和 <a href=\"https://github.com/yoshinari-nomura/org-octopress/blob/master/org-octopress.el\">org-octopress/org-octopress.el at master · yoshinari-nomura/org-octopress</a> 。\n</p>\n\n<p>\nemacs-lisp easy-to-hack 的特性在这里得到充分的体现，我们很容易在不修改原有代码的情况下改变其行为。这里我只是改变了列表显示和新建文章的行为，你可以在阅读原来的代码后更加随心所欲的修改。\n</p>\n</div>\n</div>\n"}
